<!-- <div class="">
	<h2>当サイトについて</h2>
	<div class="about-body">
		<p>当サイトでは、</p>
	</div>
</div> -->

<div>
	<h2>スポット登録</h2>
</div>
<script src="https://maps.google.com/maps/api/js?v=3.exp&amp;key=AIzaSyDSm9JoN7yTni_Q6NOHxFPl9WxiGKn5J9U&amp;language=ja&amp;libraries=places"></script>

<div id="map-content" class="container-fluid mp0">
	<!-- 検索バー -->
	<div id="menu" style="width: 370px; height: 100px;">
		<div class="col-md-12" style="margin-top:20px">
			<span>登録したいスポット名を検索してください
			<div class="input-group">
				<input type="text" id="find-place-query" class="form-control" placeholder="スポット名 (例: 清水寺)">
				<span class="input-group-btn">
					<button id="find-place-query-button" class="btn btn-default" type="button">
						<span class="glyphicon glyphicon-search" aria-hidden="true">検索</span>
					</button>
				</span>
			</div>

			
			<textarea id="result-area" style="width:100%; height:100px;font-size:.85em;" wrap="off"></textarea>
		</span></span></span></span></span></div>
	</div>
	<!-- マップ表示 -->
	<div id="map" style="width:500px; height:500px"></div>
</div>

<style>
	#map-content{
		height: 500px;
		width: 100%;
		white-space: nowrap;
	}
	#map{
		height: 100%;
		width: 500px;
		/*float: right;*/
		/*margin-right: 100px;*/
		display: inline-block;
		/*white-space: nowrap;*/
		
	}

	#menu{
		height: 100%;
		width: 300px;
		/*margin-left: 100px;*/
		/*float: left;*/
		display: inline-block;
		/*white-space: nowrap;*/
	}

	#result-area{

	}
</style>

<script>
$(function() {
	var _map = null;
	var _center = new google.maps.LatLng(34.985849, 135.75876670000002);
	var _zoom = 14;
	var _markerGeo = null;
	var _menuWidth = 400;
	var _placesService = null;
	var _markers = [];

	// 地図の初期化
	var initMap = function() {
		_map = new google.maps.Map(document.getElementById("map"), {
			zoom : _zoom,
			center: _center,
			mayTypeId: google.maps.MapTypeId.ROADMAP,
			mapTypeControlOptions: {
			    position: google.maps.ControlPosition.BOTTOM_CENTER
			}
		});
		_placesService = new google.maps.places.PlacesService(_map);
	};

	// スポット検索
	var findPlaceFromQuery = function() {
		clearMarkers();
		_placesService.findPlaceFromQuery({
			query: $('#find-place-query').val(),
			fields: ['name', 'formatted_address', 'geometry', 'place_id']
		}, function(results, status) {
			console.log(results);
			$('#result-area').val(JSON.stringify(results, null, '\t'));
			if (status == google.maps.places.PlacesServiceStatus.OK) {
				for (var i = 0; i < results.length; i++) {
					var place = results[i];
					createMarker(place);
					_map.setCenter(place.geometry.location);
				}
			} else {
				alert('失敗しました。' + status);
			}
		});
	};

	// 詳細情報検索
	var placeDetails = function() {
		clearMarkers();
		_placesService.getDetails({
			placeId: $('#place-details').val(),
			fields: ['website']
		}, function(place, status) {
			console.log(place);
			$('#result-area').val(JSON.stringify(place, null, '\t'));
			// if (status == google.maps.places.PlacesServiceStatus.OK) {
			// 	createMarker(place);
			// } else {
			// 	alert('失敗しました。' + status);
			// }
		});
	};

	var clearMarkers = function() {
		$.each(_markers, function(i, marker) {
			marker.setMap(null);
		});
		_markers = [];
	};

	var createMarker = function(place) {
		var marker = new google.maps.Marker({
			map: _map,
			position: place.geometry.location,
			title: place.name
		});
		_markers.push(marker);
	};

	// ジオコードを実行し、地図を移動
	var geocode = function(address) {
		var geocoder = new google.maps.Geocoder();
		geocoder.geocode({
			address: address
		}, function(results, status) {
			if (status == google.maps.GeocoderStatus.OK) {
				_map.setCenter(results[0].geometry.location);
				if (_markerGeo == null) {
					_markerGeo = new google.maps.Marker({
						map: _map,
						position: results[0].geometry.location
					});
				} else {
					_markerGeo.setPosition(results[0].geometry.location);
				}
			}
		});
	};

	// ウィンドウサイズに合わせて、地図領域をリサイズ
	// var resize = function() {
	// 	// ウィンドウの高さ
	// 	var h = $(window).height();
	// 	$('#map-content').height(h - $('.navbar-default').height());
	// 	// ウィンドウの幅
	// 	var w = $(window).width();
	// 	if (w < 768) {
	// 		$('#menu').width('100%');
	// 		$('#map').width('100%');
	// 		$('#menu').height('60%');
	// 		$('#map').height('40%');
	// 	} else {
	// 		// $('#menu').width(_menuWidth + 'px');
	// 		// $('#map').width(w - $('#menu').width());
	// 		// $('#menu').height('100%');
	// 		// $('#map').height('100%');
	// 	}
	// }

	// 起動時の処理
	$(window).on('load', function() {
		initMap();
		// resize();

		$('#search-button').on('click', function(e) {
			geocode($('#search-text').val());
		});

		$('#search-text').on('keypress', function(e) {
			if (e.which === 13) {
				geocode($('#search-text').val());
				return false;
			}
		});

		$('#find-place-query-button').on('click', findPlaceFromQuery);
		$('#find-place-phone-button').on('click', findPlaceFromPhoneNumber);
		$('#nearby-search-button').on('click', nearbySearch);
		$('#text-search-button').on('click', textSearch);
		$('#place-details-button').on('click', placeDetails);
	});
    
	$(window).on('resize', resize);
	$('.navbar-collapse').on('hidden.bs.collapse',resize);
	$('.navbar-collapse').on('shown.bs.collapse',resize);	
});
</script>